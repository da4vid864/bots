[phases.setup]
nixPkgs = ["nodejs_20", "chromium"]

[phases.install]
# 1. We removed '--production' so that 'vite' (a dev dependency) is installed.
# 2. We added 'cd client && npm ci' to ensure the frontend dependencies are installed too.
cmds = ["npm ci", "cd client && npm ci"]

[phases.build]
# Explicitly run your build script
cmds = ["npm run build"]

[env]
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "true"
PUPPETEER_EXECUTABLE_PATH = "/usr/bin/chromium"

[start]
cmd = "npm start"